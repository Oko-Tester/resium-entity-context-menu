{"version":3,"sources":["../src/components/ResiumEntityContextMenu.tsx"],"sourcesContent":["import { Entity, Viewer } from 'cesium';\r\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nexport type MenuItem = {\r\n  id: string;\r\n  label: string;\r\n  icon?: React.ReactNode;\r\n  disabled?: boolean;\r\n  separator?: boolean;\r\n  meta?: any;\r\n};\r\n\r\nexport type PositionOffset = { x: number; y: number };\r\n\r\nexport interface ResiumEntityContextMenuProps {\r\n  entity?: Entity | string;\r\n  getMenuItems: (entity?: Entity | string) => MenuItem[] | Promise<MenuItem[]>;\r\n  renderMenuItem?: (item: MenuItem) => React.ReactNode;\r\n  onSelect?: (item: MenuItem, entity?: Entity | string) => void | Promise<void>;\r\n  openOn?: 'rightClick' | 'leftClick' | 'hover' | 'longPress';\r\n  positionOffset?: PositionOffset;\r\n  portal?: boolean;\r\n  closeOnOutsideClick?: boolean;\r\n  keyboardNavigation?: boolean;\r\n  className?: string;\r\n  style?: React.CSSProperties;\r\n  disabled?: boolean;\r\n  zIndex?: number;\r\n  viewer?: Viewer | null;\r\n  hoverDelay?: number;\r\n  longPressDuration?: number;\r\n}\r\n\r\nconst clamp = (value: number, min: number, max: number) => Math.max(min, Math.min(max, value));\r\n\r\nexport default function ResiumEntityContextMenu(props: ResiumEntityContextMenuProps) {\r\n  const {\r\n    entity,\r\n    getMenuItems,\r\n    renderMenuItem,\r\n    onSelect,\r\n    openOn = 'rightClick',\r\n    positionOffset = { x: 4, y: 4 },\r\n    portal = true,\r\n    closeOnOutsideClick = true,\r\n    keyboardNavigation = true,\r\n    className = '',\r\n    style = {},\r\n    disabled = false,\r\n    zIndex = 3000,\r\n    viewer = null,\r\n    hoverDelay = 250,\r\n    longPressDuration = 500,\r\n  } = props;\r\n\r\n  // State\r\n  const [open, setOpen] = useState(false);\r\n  const [x, setX] = useState<number>(0);\r\n  const [y, setY] = useState<number>(0);\r\n  const [items, setItems] = useState<MenuItem[] | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [focusIndex, setFocusIndex] = useState<number>(-1);\r\n\r\n  // Refs\r\n  const callIdRef = useRef(0);\r\n  const menuRef = useRef<HTMLDivElement | null>(null);\r\n  const itemsRefs = useRef<Array<HTMLButtonElement | null>>([]);\r\n  const hoverTimerRef = useRef<number | null>(null);\r\n  const longPressTimerRef = useRef<number | null>(null);\r\n\r\n  // Project entity to screen coordinates\r\n  const projectEntityToScreen = useCallback(\r\n    (entityRef?: Entity | string, viewerRef?: Viewer | null) => {\r\n      try {\r\n        if (!viewerRef || !entityRef) return null;\r\n\r\n        const ent =\r\n          typeof entityRef === 'string' ? viewerRef.entities?.getById(entityRef) : entityRef;\r\n\r\n        if (!ent?.position) return null;\r\n\r\n        const time = viewerRef.clock?.currentTime;\r\n        const cartesian = ent.position.getValue(time);\r\n        if (!cartesian) return null;\r\n\r\n        // Use Cesium's SceneTransforms\r\n        const windowCoord = (window as any).Cesium?.SceneTransforms?.wgs84ToWindowCoordinates(\r\n          viewerRef.scene,\r\n          cartesian,\r\n        );\r\n\r\n        return windowCoord ? { x: windowCoord.x, y: windowCoord.y } : null;\r\n      } catch {\r\n        return null;\r\n      }\r\n    },\r\n    [],\r\n  );\r\n\r\n  // Load menu items with race condition protection\r\n  const loadMenuItems = useCallback(\r\n    async (entityArg?: Entity | string) => {\r\n      const myCall = ++callIdRef.current;\r\n      setLoading(true);\r\n      setError(null);\r\n      setItems(null);\r\n\r\n      try {\r\n        const res = await getMenuItems(entityArg);\r\n\r\n        if (callIdRef.current === myCall) {\r\n          setItems(res || []);\r\n          setLoading(false);\r\n          setError(null);\r\n\r\n          const firstIndex = (res || []).findIndex((it) => !it.disabled && !it.separator);\r\n          setFocusIndex(firstIndex >= 0 ? firstIndex : -1);\r\n        }\r\n      } catch (e) {\r\n        if (callIdRef.current === myCall) {\r\n          setItems(null);\r\n          setLoading(false);\r\n          setError('Fehler beim Laden der Menüeinträge');\r\n        }\r\n      }\r\n    },\r\n    [getMenuItems],\r\n  );\r\n\r\n  // Open menu at coordinates\r\n  const openMenuAt = useCallback(\r\n    async (clientX: number, clientY: number) => {\r\n      if (disabled) return;\r\n\r\n      // Try to project entity position if viewer and entity are available\r\n      if (viewer && entity) {\r\n        const proj = projectEntityToScreen(entity, viewer);\r\n        if (proj) {\r\n          clientX = proj.x;\r\n          clientY = proj.y;\r\n        }\r\n      }\r\n\r\n      setX(clientX + positionOffset.x);\r\n      setY(clientY + positionOffset.y);\r\n      setOpen(true);\r\n\r\n      await loadMenuItems(entity);\r\n    },\r\n    [disabled, entity, loadMenuItems, positionOffset, projectEntityToScreen, viewer],\r\n  );\r\n\r\n  // Close menu\r\n  const closeMenu = useCallback(() => {\r\n    setOpen(false);\r\n    setItems(null);\r\n    setLoading(false);\r\n    setError(null);\r\n    setFocusIndex(-1);\r\n    callIdRef.current++;\r\n  }, []);\r\n\r\n  // Click outside to close\r\n  useEffect(() => {\r\n    if (!open || !closeOnOutsideClick) return;\r\n\r\n    const onDocClick = (e: MouseEvent) => {\r\n      if (menuRef.current?.contains(e.target as Node)) return;\r\n      closeMenu();\r\n    };\r\n\r\n    document.addEventListener('mousedown', onDocClick);\r\n    return () => document.removeEventListener('mousedown', onDocClick);\r\n  }, [open, closeOnOutsideClick, closeMenu]);\r\n\r\n  // Position clamping on resize\r\n  useEffect(() => {\r\n    if (!open) return;\r\n\r\n    const onResize = () => {\r\n      requestAnimationFrame(() => {\r\n        if (!menuRef.current) return;\r\n\r\n        const menuRect = menuRef.current.getBoundingClientRect();\r\n        const vw = window.innerWidth;\r\n        const vh = window.innerHeight;\r\n\r\n        let newX = x;\r\n        let newY = y;\r\n\r\n        if (menuRect.right > vw) newX = clamp(vw - menuRect.width - 8, 0, vw);\r\n        if (menuRect.bottom > vh) newY = clamp(vh - menuRect.height - 8, 0, vh);\r\n\r\n        if (newX !== x) setX(newX);\r\n        if (newY !== y) setY(newY);\r\n      });\r\n    };\r\n\r\n    window.addEventListener('resize', onResize);\r\n    return () => window.removeEventListener('resize', onResize);\r\n  }, [open, x, y]);\r\n\r\n  // Keyboard navigation\r\n  useEffect(() => {\r\n    if (!open || !keyboardNavigation || !items) return;\r\n\r\n    const onKey = (ev: KeyboardEvent) => {\r\n      if (ev.key === 'Escape') {\r\n        ev.preventDefault();\r\n        closeMenu();\r\n        return;\r\n      }\r\n\r\n      const visibleItems = items.filter((it) => !it.disabled && !it.separator);\r\n      if (visibleItems.length === 0) return;\r\n\r\n      if (ev.key === 'ArrowDown') {\r\n        ev.preventDefault();\r\n        let next = focusIndex;\r\n        for (let i = 1; i <= items.length; i++) {\r\n          const idx = (focusIndex + i) % items.length;\r\n          const it = items[idx];\r\n          if (!it.disabled && !it.separator) {\r\n            next = idx;\r\n            break;\r\n          }\r\n        }\r\n        setFocusIndex(next);\r\n      } else if (ev.key === 'ArrowUp') {\r\n        ev.preventDefault();\r\n        let prev = focusIndex;\r\n        for (let i = 1; i <= items.length; i++) {\r\n          const idx = (focusIndex - i + items.length) % items.length;\r\n          const it = items[idx];\r\n          if (!it.disabled && !it.separator) {\r\n            prev = idx;\r\n            break;\r\n          }\r\n        }\r\n        setFocusIndex(prev);\r\n      } else if (ev.key === 'Enter') {\r\n        ev.preventDefault();\r\n        const it = items[focusIndex];\r\n        if (it && !it.disabled && !it.separator) {\r\n          handleItemSelect(it);\r\n        }\r\n      }\r\n    };\r\n\r\n    document.addEventListener('keydown', onKey);\r\n    return () => document.removeEventListener('keydown', onKey);\r\n  }, [open, keyboardNavigation, items, focusIndex]);\r\n\r\n  // Focus management\r\n  useEffect(() => {\r\n    if (!open || focusIndex < 0 || !items) return;\r\n\r\n    requestAnimationFrame(() => {\r\n      itemsRefs.current[focusIndex]?.focus();\r\n    });\r\n  }, [focusIndex, open, items]);\r\n\r\n  // Event handlers setup\r\n  useEffect(() => {\r\n    if (disabled) return;\r\n\r\n    const getCoordinates = (ev: MouseEvent | TouchEvent) => {\r\n      if ('clientX' in ev) {\r\n        return { x: ev.clientX, y: ev.clientY };\r\n      }\r\n      if (ev.touches && ev.touches.length > 0) {\r\n        return { x: ev.touches[0].clientX, y: ev.touches[0].clientY };\r\n      }\r\n      return { x: window.innerWidth / 2, y: window.innerHeight / 2 };\r\n    };\r\n\r\n    const onContextMenu = (ev: MouseEvent) => {\r\n      if (openOn !== 'rightClick') return;\r\n      ev.preventDefault();\r\n      const coords = getCoordinates(ev);\r\n      void openMenuAt(coords.x, coords.y);\r\n    };\r\n\r\n    const onLeftClick = (ev: MouseEvent) => {\r\n      if (openOn !== 'leftClick' || ev.button !== 0) return;\r\n      const coords = getCoordinates(ev);\r\n      void openMenuAt(coords.x, coords.y);\r\n    };\r\n\r\n    const onMouseMove = (ev: MouseEvent) => {\r\n      if (openOn !== 'hover') return;\r\n\r\n      if (hoverTimerRef.current) {\r\n        clearTimeout(hoverTimerRef.current);\r\n      }\r\n\r\n      const coords = getCoordinates(ev);\r\n      hoverTimerRef.current = window.setTimeout(() => {\r\n        void openMenuAt(coords.x, coords.y);\r\n      }, hoverDelay);\r\n    };\r\n\r\n    const onTouchStart = (ev: TouchEvent) => {\r\n      if (openOn !== 'longPress') return;\r\n\r\n      if (longPressTimerRef.current) {\r\n        clearTimeout(longPressTimerRef.current);\r\n      }\r\n\r\n      const coords = getCoordinates(ev);\r\n      longPressTimerRef.current = window.setTimeout(() => {\r\n        void openMenuAt(coords.x, coords.y);\r\n      }, longPressDuration);\r\n    };\r\n\r\n    const onTouchEnd = () => {\r\n      if (longPressTimerRef.current) {\r\n        clearTimeout(longPressTimerRef.current);\r\n        longPressTimerRef.current = null;\r\n      }\r\n    };\r\n\r\n    document.addEventListener('contextmenu', onContextMenu);\r\n    document.addEventListener('click', onLeftClick);\r\n    document.addEventListener('mousemove', onMouseMove);\r\n    document.addEventListener('touchstart', onTouchStart, { passive: true });\r\n    document.addEventListener('touchend', onTouchEnd);\r\n\r\n    return () => {\r\n      document.removeEventListener('contextmenu', onContextMenu);\r\n      document.removeEventListener('click', onLeftClick);\r\n      document.removeEventListener('mousemove', onMouseMove);\r\n      document.removeEventListener('touchstart', onTouchStart);\r\n      document.removeEventListener('touchend', onTouchEnd);\r\n\r\n      if (hoverTimerRef.current) clearTimeout(hoverTimerRef.current);\r\n      if (longPressTimerRef.current) clearTimeout(longPressTimerRef.current);\r\n    };\r\n  }, [openOn, openMenuAt, hoverDelay, longPressDuration, disabled]);\r\n\r\n  const handleItemSelect = async (item: MenuItem) => {\r\n    try {\r\n      await onSelect?.(item, entity);\r\n    } catch (error) {\r\n      console.error('Error selecting menu item:', error);\r\n    } finally {\r\n      closeMenu();\r\n    }\r\n  };\r\n\r\n  if (!open) return null;\r\n\r\n  const menuContent = (\r\n    <div\r\n      ref={menuRef}\r\n      role=\"menu\"\r\n      className={`resium-entity-contextmenu ${className}`}\r\n      style={{\r\n        position: 'fixed',\r\n        left: x,\r\n        top: y,\r\n        zIndex,\r\n        minWidth: 160,\r\n        padding: 8,\r\n        backgroundColor: 'white',\r\n        border: '1px solid #ddd',\r\n        borderRadius: 6,\r\n        boxShadow: '0 4px 12px rgba(0,0,0,0.15)',\r\n        outline: 'none',\r\n        ...style,\r\n      }}\r\n    >\r\n      {loading && <div style={{ padding: '8px 12px', color: '#666' }}>Laden...</div>}\r\n\r\n      {error && <div style={{ padding: '8px 12px', color: '#d32f2f' }}>{error}</div>}\r\n\r\n      {!loading && !error && items && items.length === 0 && (\r\n        <div style={{ padding: '8px 12px', color: '#666' }}>Keine Aktionen verfügbar</div>\r\n      )}\r\n\r\n      {!loading && !error && items && items.length > 0 && (\r\n        <div>\r\n          {items.map((item, idx) => {\r\n            if (item.separator) {\r\n              return (\r\n                <div\r\n                  key={`separator-${idx}`}\r\n                  style={{\r\n                    height: 1,\r\n                    backgroundColor: '#eee',\r\n                    margin: '4px 0',\r\n                  }}\r\n                />\r\n              );\r\n            }\r\n\r\n            const isDisabled = !!item.disabled;\r\n            const isFocused = focusIndex === idx;\r\n            const setItemRef = useCallback((el: HTMLButtonElement | null, idx: number) => {\r\n              itemsRefs.current[idx] = el;\r\n            }, []);\r\n\r\n            return (\r\n              <button\r\n                key={item.id}\r\n                ref={(el) => setItemRef(el, idx)}\r\n                role=\"menuitem\"\r\n                disabled={isDisabled}\r\n                tabIndex={-1}\r\n                onClick={() => !isDisabled && handleItemSelect(item)}\r\n                onMouseEnter={() => setFocusIndex(idx)}\r\n                style={{\r\n                  display: 'block',\r\n                  width: '100%',\r\n                  padding: '8px 12px',\r\n                  border: 'none',\r\n                  backgroundColor: isFocused ? '#f5f5f5' : 'transparent',\r\n                  textAlign: 'left',\r\n                  cursor: isDisabled ? 'not-allowed' : 'pointer',\r\n                  borderRadius: 4,\r\n                  opacity: isDisabled ? 0.5 : 1,\r\n                }}\r\n              >\r\n                {renderMenuItem ? (\r\n                  renderMenuItem(item)\r\n                ) : (\r\n                  <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                    {item.icon && <span>{item.icon}</span>}\r\n                    <span>{item.label}</span>\r\n                  </div>\r\n                )}\r\n              </button>\r\n            );\r\n          })}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n\r\n  return portal ? ReactDOM.createPortal(menuContent, document.body) : menuContent;\r\n}\r\n"],"mappings":"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","names":["error","idx"]}